<!doctype html>
<html>
  <head>
    <title>Save User</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body
    class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4"
  >
    <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
      <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">
        User Registration
      </h2>

      <form id="userForm" class="space-y-4">
        <input
          type="text"
          placeholder="First Name"
          id="firstName"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="Last Name"
          id="lastName"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="Mobile (10 digits)"
          id="mobile"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="Email"
          id="email"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="Street"
          id="street"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="City"
          id="city"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="State"
          id="state"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="text"
          placeholder="Country"
          id="country"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />

        <input
          type="text"
          placeholder="Login ID (8 chars)"
          id="loginId"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />
        <input
          type="password"
          placeholder="Password"
          id="password"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
        />

        <button
          type="button"
          onclick="saveUser()"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 transform hover:scale-105 mt-6"
        >
          Save User
        </button>
      </form>

      <div class="text-center mt-6">
        <a
          href="view.html"
          class="text-blue-600 hover:text-blue-800 font-medium"
          >View All Users</a
        >
        <span class="mx-2">|</span>
        <a
          href="live.html"
          class="text-blue-600 hover:text-blue-800 font-medium"
          >Live Users</a
        >
      </div>
    </div>

    <script>
      const socket = io();

      function saveUser() {
        const data = {
          firstName: $("#firstName").val(),
          lastName: $("#lastName").val(),
          mobile: $("#mobile").val(),
          email: $("#email").val(),
          address: {
            street: $("#street").val(),
            city: $("#city").val(),
            state: $("#state").val(),
            country: $("#country").val(),
          },
          loginId: $("#loginId").val(),
          password: $("#password").val(),
        };

        $.ajax({
          url: "/api/saveUser",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify(data),
          success: function (res) {
            alert(res.message);

            const name = `${data.firstName} ${data.lastName}`;
            socket.emit("join_live_users", { email: data.email, name });

            localStorage.setItem(
              "chatUser",
              JSON.stringify({ name, email: data.email }),
            );

            window.location.href = `chat.html?name=${encodeURIComponent(
              name,
            )}&email=${encodeURIComponent(data.email)}`;

            $("#userForm")[0].reset();
          },
          error: function (err) {
            alert("Error: " + (err.responseJSON?.error || err.statusText));
          },
        });
      }
    </script>
  </body>
</html>
